#include <stdio.h>

#include "xaxidma.h"
#include "xparameters.h"
#include "xdebug.h"

#include "axidma_header.h"
#include "devcfg_header.h"
#include "dmaps_header.h"
#include "qspips_header.h"
#include "scugic_header.h"
#include "scutimer_header.h"
#include "scuwdt_header.h"
#include "xdevcfg.h"
#include "xdmaps.h"
#include "xil_cache.h"
#include "xil_exception.h"
#include "xparameters.h"
#include "xqspips.h"
#include "xscugic.h"
#include "xscutimer.h"
#include "xscuwdt.h"

XAxiDma AxiDma;

#define check(x)                 \
  do {                           \
    Status = (x);                \
    if (Status != XST_SUCCESS) { \
      return XST_FAILURE;        \
    }                            \
  } while (0)

int testPeriph(u16 DeviceId) {
  XAxiDma_Config *CfgPtr;
  int Status = XST_SUCCESS;

  CfgPtr = XAxiDma_LookupConfig(DeviceId);
  if (!CfgPtr) {
    return XST_FAILURE;
  }

  check(XAxiDma_CfgInitialize(&AxiDma, CfgPtr));

  check(XAxiDma_Selftest(&AxiDma));

  return Status;
}

int main() {
  int Status = XST_SUCCESS;
  Status = testPeriph(XPAR_SENDER_AXI_DMA_0_DEVICE_ID);
  if (Status != XST_SUCCESS) {
    printf("Test Err: %d\n", Status);
  } else {
    puts("Test All done.\n");
  }
  return 0;
}
